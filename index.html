<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ESP8266 Deauther Store</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<style>
:root{
  --bg:#0a0a0f;--surface:#111118;--card:#16161f;--border:#2a2a3a;
  --accent:#00f5a0;--accent2:#00c3f5;--danger:#ff3c5a;--warn:#ffb400;
  --text:#e8e8f0;--muted:#888899;
  --fh:'Syne',sans-serif;--fm:'Space Mono',monospace;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;}
body{background:var(--bg);color:var(--text);font-family:var(--fm);}

/* â•â• MAIN SPLIT LAYOUT â•â• */
.app{display:flex;height:100vh;width:100vw;}

/* â”€â”€ LEFT: STORE â”€â”€ */
.store{flex:1;overflow-y:auto;min-width:0;position:relative;}
.store::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:linear-gradient(rgba(0,245,160,0.02) 1px,transparent 1px),
  linear-gradient(90deg,rgba(0,245,160,0.02) 1px,transparent 1px);
  background-size:44px 44px;}

/* â”€â”€ RIGHT: ADMIN PANEL â”€â”€ */
.admin-panel{
  width:340px;min-width:340px;height:100vh;overflow-y:auto;
  background:var(--surface);border-left:2px solid var(--border);
  display:flex;flex-direction:column;
}

/* ADMIN: login wall */
.admin-lock{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  height:100%;padding:32px;text-align:center;
}
.lock-icon{font-size:2.5rem;margin-bottom:16px;}
.lock-title{font-family:var(--fh);font-size:1.1rem;font-weight:800;margin-bottom:6px;}
.lock-sub{color:var(--muted);font-size:0.68rem;margin-bottom:24px;line-height:1.7;}
.lock-line{width:100%;height:1px;background:var(--border);margin-bottom:24px;}

/* ADMIN: dashboard */
.admin-dash{display:none;flex-direction:column;height:100%;}
.admin-dash.active{display:flex;}
.adash-head{
  padding:14px 16px;border-bottom:1px solid var(--border);
  background:var(--card);flex-shrink:0;
}
.adash-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.adash-logo{font-family:var(--fh);font-size:0.85rem;font-weight:800;}
.adash-logo span{color:var(--danger);}
.btn-logout{background:none;border:1px solid var(--border);color:var(--muted);
  font-family:var(--fm);font-size:0.6rem;padding:4px 10px;cursor:pointer;}
.btn-logout:hover{border-color:var(--danger);color:var(--danger);}
.adash-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;}
.stat{background:var(--surface);border:1px solid var(--border);padding:8px;text-align:center;}
.stat-l{font-size:0.5rem;letter-spacing:2px;color:var(--muted);text-transform:uppercase;margin-bottom:3px;}
.stat-v{font-family:var(--fh);font-size:1.3rem;font-weight:800;color:var(--accent);}
.stat-v.y{color:var(--warn);}
.adash-body{flex:1;overflow-y:auto;padding:10px;}
.btn-refresh{width:100%;background:none;border:1px solid var(--border);color:var(--muted);
  font-family:var(--fm);font-size:0.62rem;padding:7px;cursor:pointer;margin-bottom:8px;}
.btn-refresh:hover{border-color:var(--accent);color:var(--accent);}

/* ORDER CARDS */
.ocard{background:var(--card);border:1px solid var(--border);margin-bottom:8px;
  padding:12px;position:relative;transition:border 0.2s;}
.ocard.pending{border-left:3px solid var(--warn);}
.ocard.sent{border-left:3px solid var(--accent);opacity:0.7;}
.o-num{font-size:0.52rem;letter-spacing:2px;color:var(--muted);text-transform:uppercase;margin-bottom:3px;}
.o-email{font-size:0.73rem;color:var(--accent2);margin-bottom:3px;word-break:break-all;}
.o-tx{font-size:0.6rem;color:var(--muted);margin-bottom:3px;}
.o-time{font-size:0.57rem;color:var(--muted);margin-bottom:8px;}
.o-pill{display:inline-block;padding:2px 8px;font-size:0.55rem;letter-spacing:1px;
  text-transform:uppercase;margin-bottom:8px;}
.pill-p{background:rgba(255,180,0,0.12);color:var(--warn);border:1px solid rgba(255,180,0,0.3);}
.pill-s{background:rgba(0,245,160,0.08);color:var(--accent);border:1px solid rgba(0,245,160,0.25);}
.o-btns{display:flex;gap:4px;flex-wrap:wrap;}
.btn-accept{background:var(--accent);color:#000;border:none;font-family:var(--fm);
  font-size:0.58rem;font-weight:700;padding:6px 8px;cursor:pointer;flex:1;transition:all 0.2s;}
.btn-accept:hover:not(:disabled){background:#00c87a;}
.btn-accept:disabled{background:var(--border);color:var(--muted);cursor:not-allowed;}
.btn-email{background:var(--accent2);color:#000;border:none;font-family:var(--fm);
  font-size:0.6rem;font-weight:700;padding:6px 9px;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;}
.btn-email:hover{background:#00a8d6;}
.btn-del{background:none;border:1px solid var(--border);color:var(--muted);
  font-family:var(--fm);font-size:0.6rem;padding:5px 8px;cursor:pointer;}
.btn-del:hover{border-color:var(--danger);color:var(--danger);}
.no-orders{text-align:center;padding:30px 10px;color:var(--muted);font-size:0.7rem;line-height:1.8;}
.send-overlay{position:absolute;inset:0;background:rgba(10,10,15,0.9);
  display:flex;align-items:center;justify-content:center;font-size:0.68rem;color:var(--accent);}
@keyframes rot{to{transform:rotate(360deg)}}
.spin{display:inline-block;animation:rot 1s linear infinite;margin-right:6px;}

/* â”€â”€ FORM ELEMENTS (shared) â”€â”€ */
label{display:block;font-size:0.6rem;letter-spacing:2px;color:var(--muted);
  text-transform:uppercase;margin-bottom:5px;margin-top:12px;}
input[type=email],input[type=text],input[type=password]{
  width:100%;background:var(--bg);border:1px solid var(--border);color:var(--text);
  font-family:var(--fm);font-size:0.78rem;padding:10px 12px;outline:none;transition:border 0.2s;}
input:focus{border-color:var(--accent);}
.btn-main{width:100%;font-family:var(--fm);font-size:0.78rem;font-weight:700;
  letter-spacing:2px;padding:13px;border:none;cursor:pointer;text-transform:uppercase;
  margin-top:14px;transition:all 0.2s;}
.btn-main.green{background:var(--accent);color:#000;}
.btn-main.green:hover{background:#00c87a;}
.btn-main.red{background:var(--danger);color:#fff;}
.btn-main.red:hover{background:#cc2a45;}
.btn-main:disabled{background:var(--border);color:var(--muted);cursor:not-allowed;}
.err-msg{color:var(--danger);font-size:0.65rem;margin-top:7px;display:none;line-height:1.6;}
.err-msg.show{display:block;}

/* â”€â”€ STORE NAV â”€â”€ */
.s-nav{display:flex;align-items:center;justify-content:space-between;padding:16px 30px;
  border-bottom:1px solid var(--border);background:rgba(10,10,15,0.95);
  backdrop-filter:blur(20px);position:sticky;top:0;z-index:100;}
.logo{font-family:var(--fh);font-size:1.2rem;font-weight:800;letter-spacing:2px;}
.logo span{color:var(--accent);}
.nav-tag{font-size:0.58rem;letter-spacing:3px;color:var(--accent);padding:4px 9px;
  border:1px solid var(--accent);text-transform:uppercase;}

/* â”€â”€ HERO â”€â”€ */
.hero{display:grid;grid-template-columns:1fr 1fr;gap:0;min-height:80vh;
  align-items:center;padding:60px 30px;max-width:900px;margin:0 auto;position:relative;z-index:1;}
.hero-text{padding-right:40px;}
.tag-line{font-size:0.6rem;letter-spacing:4px;color:var(--accent);text-transform:uppercase;
  margin-bottom:18px;display:flex;align-items:center;gap:10px;}
.tag-line::before{content:'';display:block;width:28px;height:1px;background:var(--accent);}
h1{font-family:var(--fh);font-size:clamp(2rem,3.5vw,3.2rem);font-weight:800;line-height:1.08;
  margin-bottom:20px;background:linear-gradient(135deg,#fff 40%,var(--accent) 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.hero-desc{color:var(--muted);line-height:1.8;font-size:0.78rem;margin-bottom:28px;}
.price-block{display:flex;align-items:flex-end;gap:14px;margin-bottom:28px;}
.price{font-family:var(--fh);font-size:3rem;font-weight:800;color:var(--accent);}
.price-note{color:var(--muted);font-size:0.64rem;margin-bottom:10px;line-height:1.6;}
.btn-order{display:inline-block;background:var(--accent);color:#000;font-family:var(--fm);
  font-size:0.82rem;font-weight:700;letter-spacing:2px;padding:15px 38px;border:none;
  cursor:pointer;text-transform:uppercase;transition:all 0.2s;
  clip-path:polygon(0 0,calc(100% - 12px) 0,100% 12px,100% 100%,12px 100%,0 calc(100% - 12px));}
.btn-order:hover{background:#fff;transform:translateY(-2px);}

/* PRODUCT CARD */
.hero-visual{display:flex;align-items:center;justify-content:center;position:relative;}
.glow{position:absolute;width:260px;height:260px;border-radius:50%;pointer-events:none;
  background:radial-gradient(circle,rgba(0,245,160,0.07) 0%,transparent 70%);
  animation:gp 4s ease-in-out infinite;}
@keyframes gp{0%,100%{opacity:0.5}50%{opacity:1}}
.pcard{background:var(--card);border:1px solid var(--border);padding:26px;
  width:100%;max-width:320px;position:relative;overflow:hidden;animation:fl 4s ease-in-out infinite;}
@keyframes fl{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.pcard::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,var(--accent),var(--accent2),transparent);
  animation:gs 3s linear infinite;}
@keyframes gs{0%{opacity:0.3}50%{opacity:1}100%{opacity:0.3}}
.pimg{background:#0d0d15;border:1px solid var(--border);display:flex;align-items:center;
  justify-content:center;margin-bottom:16px;height:160px;position:relative;}
.pbadge{position:absolute;top:8px;right:8px;background:var(--accent);color:#000;
  font-size:0.56rem;font-weight:700;letter-spacing:2px;padding:3px 6px;text-transform:uppercase;}
.spec{display:flex;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--border);font-size:0.65rem;}
.spec:last-child{border:none;}
.sk{color:var(--muted);}.sv{color:var(--accent2);}

/* FEATURES */
.feats{padding:50px 30px;max-width:900px;margin:0 auto;position:relative;z-index:1;}
.sec-lbl{font-size:0.58rem;letter-spacing:4px;color:var(--accent);text-transform:uppercase;
  margin-bottom:24px;display:flex;align-items:center;gap:12px;}
.sec-lbl::after{content:'';flex:1;height:1px;background:var(--border);}
.feat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:var(--border);}
.feat{background:var(--card);padding:22px;transition:background 0.2s;}
.feat:hover{background:#1a1a25;}
.fi{font-size:1.2rem;margin-bottom:10px;}
.ft{font-family:var(--fh);font-size:0.88rem;font-weight:700;margin-bottom:6px;}
.fd{color:var(--muted);font-size:0.67rem;line-height:1.7;}

/* â”€â”€ PAYMENT MODAL â”€â”€ */
.modal{display:none;position:fixed;inset:0;z-index:2000;align-items:center;justify-content:center;padding:20px;}
.modal.active{display:flex;}
.mbg{position:absolute;inset:0;background:rgba(0,0,0,0.9);backdrop-filter:blur(10px);}
.mbox{position:relative;z-index:1;background:var(--card);border:1px solid var(--border);
  padding:34px;width:100%;max-width:440px;animation:slideup 0.3s ease;max-height:92vh;overflow-y:auto;}
@keyframes slideup{from{transform:translateY(28px);opacity:0}to{transform:translateY(0);opacity:1}}
.mbox::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,var(--accent),var(--accent2));}
.mclose{position:absolute;top:12px;right:14px;background:none;border:none;
  color:var(--muted);cursor:pointer;font-size:1.1rem;}
.mclose:hover{color:var(--danger);}
.mtitle{font-family:var(--fh);font-size:1.25rem;font-weight:800;margin-bottom:5px;}
.msub{color:var(--muted);font-size:0.7rem;margin-bottom:20px;line-height:1.6;}
.steps-bar{display:flex;margin-bottom:22px;}
.stp{flex:1;text-align:center;font-size:0.58rem;letter-spacing:2px;padding:8px;
  background:var(--surface);color:var(--muted);border-bottom:2px solid var(--border);text-transform:uppercase;}
.stp.on{color:var(--accent);border-bottom-color:var(--accent);background:#0d1a15;}
.stp.ok{color:var(--accent);background:#0d1a15;}
.pinfo{background:var(--surface);border:1px solid var(--border);padding:14px;margin-bottom:14px;}
.pr{display:flex;justify-content:space-between;margin-bottom:6px;font-size:0.7rem;}
.pr:last-child{margin:0;}.pl{color:var(--muted);}
.binbox{background:#0d1a15;border:1px solid var(--accent);padding:14px;margin-bottom:14px;text-align:center;}
.binlbl{font-size:0.55rem;letter-spacing:3px;color:var(--accent);text-transform:uppercase;margin-bottom:6px;}
.binid{font-family:var(--fh);font-size:1.4rem;font-weight:800;color:var(--accent);letter-spacing:5px;}
.copybtn{background:none;border:1px solid var(--accent);color:var(--accent);
  font-family:var(--fm);font-size:0.6rem;padding:4px 12px;cursor:pointer;margin-top:6px;transition:all 0.2s;}
.copybtn:hover{background:var(--accent);color:#000;}
.ok-wrap{text-align:center;padding:14px 0;}
.ok-icon{font-size:2.5rem;margin-bottom:10px;}
.ok-t{font-family:var(--fh);font-size:1.2rem;font-weight:800;color:var(--accent);margin-bottom:8px;}
.ok-d{color:var(--muted);font-size:0.7rem;line-height:1.9;}

/* TOAST */
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(60px);
  background:var(--card);border:1px solid var(--accent);color:var(--accent);
  font-family:var(--fm);font-size:0.7rem;padding:10px 22px;z-index:9999;
  transition:transform 0.3s,opacity 0.3s;opacity:0;white-space:nowrap;pointer-events:none;}
.toast.show{transform:translateX(-50%) translateY(0);opacity:1;}
.toast.err{border-color:var(--danger);color:var(--danger);}

@media(max-width:860px){
  .app{flex-direction:column;}
  .admin-panel{width:100%;min-width:0;height:auto;border-left:none;border-top:2px solid var(--border);}
  html,body{overflow:auto;height:auto;}
  .store{overflow:visible;}
  .hero{grid-template-columns:1fr;padding:40px 20px;min-height:auto;}
  .hero-text{padding-right:0;margin-bottom:30px;}
  .feat-grid{grid-template-columns:1fr;}
}
</style>
</head>
<body>

<div class="app">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• LEFT: STORE â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="store">

  <nav class="s-nav">
    <div class="logo">SECURE<span>TECH</span></div>
    <div class="nav-tag">VERIFIED STORE</div>
  </nav>

  <section class="hero">
    <div class="hero-text">
      <div class="tag-line">Digital Delivery â€” Instant</div>
      <h1>ESP8266<br/>Deauther<br/>V2.6.1</h1>
      <p class="hero-desc">DSTIKE Deauther OLED V6 â€” pre-compiled firmware, ready to flash. Stable build v2.6.1 for security research and educational purposes.</p>
      <div class="price-block">
        <div class="price">$40</div>
        <div class="price-note">One-time payment<br/>Delivered to your email</div>
      </div>
      <button class="btn-order" onclick="openPay()">ORDER NOW â†’</button>
    </div>
    <div class="hero-visual">
      <div class="glow"></div>
      <div class="pcard">
        <div class="pimg">
          <span class="pbadge">IN STOCK</span>
          <svg width="96" height="96" viewBox="0 0 120 120" fill="none">
            <rect x="25" y="25" width="70" height="70" rx="4" fill="#111" stroke="#00f5a0" stroke-width="1.5"/>
            <rect x="35" y="35" width="50" height="50" rx="2" fill="#0d1a15" stroke="#00c3f5" stroke-width="1"/>
            <text x="60" y="57" text-anchor="middle" fill="#00f5a0" font-size="7" font-family="monospace">ESP8266</text>
            <text x="60" y="68" text-anchor="middle" fill="#00c3f5" font-size="5.5" font-family="monospace">DEAUTHER</text>
            <text x="60" y="78" text-anchor="middle" fill="#888" font-size="4.5" font-family="monospace">v2.6.1 OLED V6</text>
            <rect x="10" y="38" width="15" height="3" rx="1" fill="#00f5a0" opacity="0.7"/>
            <rect x="10" y="48" width="15" height="3" rx="1" fill="#00f5a0" opacity="0.7"/>
            <rect x="10" y="58" width="15" height="3" rx="1" fill="#00f5a0" opacity="0.7"/>
            <rect x="10" y="68" width="15" height="3" rx="1" fill="#00f5a0" opacity="0.7"/>
            <rect x="10" y="78" width="15" height="3" rx="1" fill="#00f5a0" opacity="0.7"/>
            <rect x="95" y="38" width="15" height="3" rx="1" fill="#00c3f5" opacity="0.7"/>
            <rect x="95" y="48" width="15" height="3" rx="1" fill="#00c3f5" opacity="0.7"/>
            <rect x="95" y="58" width="15" height="3" rx="1" fill="#00c3f5" opacity="0.7"/>
            <rect x="95" y="68" width="15" height="3" rx="1" fill="#00c3f5" opacity="0.7"/>
            <rect x="95" y="78" width="15" height="3" rx="1" fill="#00c3f5" opacity="0.7"/>
          </svg>
        </div>
        <div class="spec"><span class="sk">FIRMWARE</span><span class="sv">v2.6.1 STABLE</span></div>
        <div class="spec"><span class="sk">BOARD</span><span class="sv">DSTIKE OLED V6</span></div>
        <div class="spec"><span class="sk">DELIVERY</span><span class="sv">EMAIL</span></div>
        <div class="spec"><span class="sk">PRICE</span><span class="sv">$40 USD</span></div>
      </div>
    </div>
  </section>

  <section class="feats">
    <div class="sec-lbl">What You Get</div>
    <div class="feat-grid">
      <div class="feat"><div class="fi">ğŸ“¦</div><div class="ft">Pre-Compiled .BIN</div><div class="fd">Ready-to-flash firmware sent to your inbox. No compiling needed.</div></div>
      <div class="feat"><div class="fi">âš¡</div><div class="ft">Fast Delivery</div><div class="fd">Digital product sent via email within 1â€“24 hours of payment verification.</div></div>
      <div class="feat"><div class="fi">ğŸ”’</div><div class="ft">v2.6.1 Verified</div><div class="fd">Stable release for DSTIKE OLED V6 hardware. Tested and verified working.</div></div>
    </div>
  </section>

</div><!-- /store -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• RIGHT: ADMIN PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="admin-panel">

  <!-- LOCK SCREEN -->
  <div class="admin-lock" id="admin-lock">
    <div class="lock-icon">ğŸ”</div>
    <div class="lock-title">Admin Panel</div>
    <div class="lock-sub">Enter password to view<br/>orders and send files</div>
    <div class="lock-line"></div>
    <label for="ap">Password</label>
    <input type="password" id="ap" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')doLogin()"/>
    <button class="btn-main red" onclick="doLogin()">LOGIN â†’</button>
    <div class="err-msg" id="lerr">Wrong password. Try again.</div>
  </div>

  <!-- DASHBOARD -->
  <div class="admin-dash" id="admin-dash">
    <div class="adash-head">
      <div class="adash-top">
        <div class="adash-logo">ADMIN <span>PANEL</span></div>
        <button class="btn-logout" onclick="doLogout()">LOGOUT</button>
      </div>
      <div class="adash-stats">
        <div class="stat"><div class="stat-l">Total</div><div class="stat-v" id="st">0</div></div>
        <div class="stat"><div class="stat-l">Pending</div><div class="stat-v y" id="sp">0</div></div>
        <div class="stat"><div class="stat-l">Sent</div><div class="stat-v" id="ss">0</div></div>
      </div>
    </div>
    <div class="adash-body">
      <button class="btn-refresh" onclick="loadOrders()">â†» REFRESH</button>
      <div id="orders-list"><div class="no-orders">Loading...</div></div>
    </div>
  </div>

</div><!-- /admin-panel -->

</div><!-- /app -->

<!-- â•â• PAYMENT MODAL â•â• -->
<div class="modal" id="pay-modal">
  <div class="mbg" onclick="closePay()"></div>
  <div class="mbox">
    <button class="mclose" onclick="closePay()">âœ•</button>

    <div id="s1">
      <div class="steps-bar"><div class="stp on">01 Payment</div><div class="stp">02 Confirm</div></div>
      <div class="mtitle">Complete Order</div>
      <div class="msub">Send exactly $40 via Binance Pay, then click Next.</div>
      <div class="pinfo">
        <div class="pr"><span class="pl">Product</span><span>ESP8266 Deauther v2.6.1</span></div>
        <div class="pr"><span class="pl">Amount</span><span style="color:var(--accent);font-weight:700">$40.00 USD</span></div>
        <div class="pr"><span class="pl">Method</span><span>Binance Pay</span></div>
      </div>
      <div class="binbox">
        <div class="binlbl">Binance Pay ID</div>
        <div class="binid">894307667</div>
        <button class="copybtn" onclick="copyID(this)">ğŸ“‹ COPY ID</button>
      </div>
      <button class="btn-main green" onclick="goS2()">I HAVE PAID â†’ NEXT</button>
    </div>

    <div id="s2" style="display:none">
      <div class="steps-bar"><div class="stp ok">01 Paid âœ“</div><div class="stp on">02 Confirm</div></div>
      <div class="mtitle">Your Email</div>
      <div class="msub">We'll send the .BIN file here after verifying your payment.</div>
      <label for="be">Email Address *</label>
      <input type="email" id="be" placeholder="you@example.com"/>
      <label for="bt">Binance TX Reference (optional)</label>
      <input type="text" id="bt" placeholder="Transaction ID or note"/>
      <button class="btn-main green" id="sbtn" onclick="submitOrder()">SUBMIT ORDER â†’</button>
      <div class="err-msg" id="serr"></div>
    </div>

    <div id="s3" style="display:none">
      <div class="ok-wrap">
        <div class="ok-icon">âœ…</div>
        <div class="ok-t">Order Received!</div>
        <div class="ok-d">Thank you! We will verify your Binance<br/>payment and send the <strong style="color:var(--accent)">.BIN file</strong><br/>to your email within <strong style="color:var(--accent)">1â€“24 hours</strong>.</div>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â•â• CONFIG â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CFG = {
  PASS      : '3085',
  DB        : 'https://jhasdjhbjhdcbnwdced-default-rtdb.firebaseio.com',
  EJ_KEY    : 'YOUR_PUBLIC_KEY',    // emailjs.com â†’ Account â†’ Public Key
  EJ_SVC    : 'YOUR_SERVICE_ID',    // emailjs.com â†’ Email Services
  EJ_TPL    : 'YOUR_TEMPLATE_ID',   // emailjs.com â†’ Email Templates
};
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const EJ_OK = CFG.EJ_KEY !== 'YOUR_PUBLIC_KEY';
if(EJ_OK) emailjs.init({publicKey: CFG.EJ_KEY});

// â”€â”€ ADMIN LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doLogin(){
  const p = document.getElementById('ap').value;
  if(p === CFG.PASS){
    document.getElementById('admin-lock').style.display = 'none';
    document.getElementById('admin-dash').classList.add('active');
    loadOrders();
  } else {
    document.getElementById('lerr').classList.add('show');
    document.getElementById('ap').value = '';
    document.getElementById('ap').focus();
  }
}
function doLogout(){
  document.getElementById('admin-lock').style.display = 'flex';
  document.getElementById('admin-dash').classList.remove('active');
  document.getElementById('ap').value = '';
  document.getElementById('lerr').classList.remove('show');
}

// â”€â”€ FIREBASE REST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fbGet(p){ const r=await fetch(`${CFG.DB}${p}.json`); return r.json(); }
async function fbPost(p,d){ const r=await fetch(`${CFG.DB}${p}.json`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(d)}); return r.json(); }
async function fbPatch(p,d){ const r=await fetch(`${CFG.DB}${p}.json`,{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify(d)}); return r.json(); }
async function fbDel(p){ await fetch(`${CFG.DB}${p}.json`,{method:'DELETE'}); }

// â”€â”€ LOAD ORDERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadOrders(){
  const list = document.getElementById('orders-list');
  list.innerHTML = '<div class="no-orders" style="animation:gs 1s infinite">Loading...</div>';
  try{
    const data = await fbGet('/orders');
    if(!data || data.error){
      list.innerHTML = `<div class="no-orders">${data&&data.error?'âš  Firebase: '+data.error:'No orders yet.'}<br/><br/><span style="font-size:0.6rem;color:var(--danger)">${data&&data.error?'Set Firebase Rules â†’ read/write: true':''}</span></div>`;
      setStats(0,0,0); return;
    }
    const orders = Object.entries(data).map(([id,v])=>({id,...v})).sort((a,b)=>(b.tsMs||0)-(a.tsMs||0));
    setStats(orders.length, orders.filter(o=>o.status==='pending').length, orders.filter(o=>o.status==='sent').length);

    list.innerHTML = orders.map((o,i)=>{
      const dt = new Date(o.timestamp||Date.now()).toLocaleString('en-GB',{day:'2-digit',month:'short',hour:'2-digit',minute:'2-digit'});
      const sent = o.status==='sent';
      const sub  = encodeURIComponent('Your ESP8266 Deauther v2.6.1 File');
      const body = encodeURIComponent(`Hi,\n\nThank you for your purchase!\n\nPlease find your ESP8266 Deauther v2.6.1 .BIN file attached to this email.\n\nFlashing Instructions:\n1. Flash the .bin file to your DSTIKE OLED V6 board\n2. Power cycle after flashing\n3. Connect to the WiFi AP\n\nOrder: ${o.id}\n\nBest regards,\nSecureTech Store`);
      const href = `mailto:${esc(o.email)}?subject=${sub}&body=${body}`;
      return `<div class="ocard ${o.status}" id="oc-${o.id}">
        <div class="o-num">#${orders.length-i} Â· ${dt}</div>
        <div class="o-email">${esc(o.email)}</div>
        <div class="o-tx">TX: ${esc(o.txid||'â€”')}</div>
        <span class="o-pill ${sent?'pill-s':'pill-p'}">${sent?'âœ“ SENT':'PENDING'}</span>
        <div class="o-btns">
          <button class="btn-accept" ${sent?'disabled':''} onclick="acceptOrder('${o.id}','${esc(o.email)}',this)">
            ${EJ_OK?'âš¡ SEND FILE':'âœ“ MARK SENT'}
          </button>
          <a class="btn-email" href="${href}">ğŸ“§</a>
          <button class="btn-del" onclick="delOrder('${o.id}')">âœ•</button>
        </div>
      </div>`;
    }).join('');
  }catch(e){
    list.innerHTML=`<div class="no-orders">âš  ${e.message}</div>`;
    setStats(0,0,0);
  }
}
function setStats(t,p,s){
  document.getElementById('st').textContent=t;
  document.getElementById('sp').textContent=p;
  document.getElementById('ss').textContent=s;
}

// â”€â”€ ACCEPT = SEND EMAIL AUTO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function acceptOrder(id, email, btn){
  const card = document.getElementById('oc-'+id);
  if(!EJ_OK){
    if(!confirm('EmailJS not set up. Just mark as sent?')) return;
    await fbPatch('/orders/'+id,{status:'sent',sentAt:new Date().toISOString()});
    toast('âœ“ Marked as sent'); loadOrders(); return;
  }
  if(!confirm('Auto-send .BIN file email to:\n'+email)) return;
  const ov=document.createElement('div');
  ov.className='send-overlay';
  ov.innerHTML='<span class="spin">âŸ³</span> Sending...';
  card.appendChild(ov);
  btn.disabled=true;
  try{
    await emailjs.send(CFG.EJ_SVC, CFG.EJ_TPL,{
      to_email:email, buyer_email:email,
      order_id:id, product:'ESP8266 Deauther v2.6.1',
      txid:'See order', time:new Date().toLocaleString()
    });
    await fbPatch('/orders/'+id,{status:'sent',sentAt:new Date().toISOString()});
    toast('âœ… File sent to '+email); loadOrders();
  }catch(e){
    ov.remove(); btn.disabled=false;
    toast('âš  Email error: '+(e.text||e.message),'err');
  }
}

// â”€â”€ DELETE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function delOrder(id){
  if(!confirm('Delete this order?')) return;
  await fbDel('/orders/'+id);
  toast('Deleted'); loadOrders();
}

// â”€â”€ PAYMENT MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openPay(){
  document.getElementById('pay-modal').classList.add('active');
  show('s1');hide('s2');hide('s3');
  document.getElementById('be').value='';
  document.getElementById('bt').value='';
  document.getElementById('serr').classList.remove('show');
  const b=document.getElementById('sbtn');b.disabled=false;b.textContent='SUBMIT ORDER â†’';
}
function closePay(){ document.getElementById('pay-modal').classList.remove('active'); }
function goS2(){ hide('s1');show('s2'); }
function show(id){ document.getElementById(id).style.display='block'; }
function hide(id){ document.getElementById(id).style.display='none'; }

function copyID(btn){
  navigator.clipboard.writeText('894307667').catch(()=>{
    const t=document.createElement('textarea');t.value='894307667';
    document.body.appendChild(t);t.select();document.execCommand('copy');document.body.removeChild(t);
  });
  btn.textContent='âœ“ COPIED!';setTimeout(()=>btn.textContent='ğŸ“‹ COPY ID',2000);
}

async function submitOrder(){
  const email=document.getElementById('be').value.trim();
  const txid=document.getElementById('bt').value.trim();
  const err=document.getElementById('serr');
  const btn=document.getElementById('sbtn');
  if(!email||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
    err.textContent='âš  Please enter a valid email.';err.classList.add('show');return;
  }
  err.classList.remove('show');btn.disabled=true;btn.textContent='SAVING...';
  const order={id:'ORD-'+Date.now(),email,txid:txid||'Not provided',
    product:'ESP8266 Deauther v2.6.1',price:'$40',status:'pending',
    timestamp:new Date().toISOString(),tsMs:Date.now()};
  try{
    const r=await fbPost('/orders',order);
    if(r&&r.error) throw new Error(r.error);
    hide('s2');show('s3');
    // refresh admin panel live
    const dash=document.getElementById('admin-dash');
    if(dash.classList.contains('active')) loadOrders();
  }catch(e){
    btn.disabled=false;btn.textContent='SUBMIT ORDER â†’';
    err.textContent='âš  Error: '+e.message+' â†’ Set Firebase rules to true';
    err.classList.add('show');
  }
}

// â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toast(msg,type=''){
  const t=document.getElementById('toast');
  t.textContent=msg;t.className='toast show '+(type||'');
  setTimeout(()=>t.className='toast',3200);
}
function esc(s){ return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
document.addEventListener('keydown',e=>{ if(e.key==='Escape') closePay(); });
</script>
</body>
</html>
